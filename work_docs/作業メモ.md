# 作業メモ

## そもそもの前提

- [java-sdk](https://github.com/modelcontextprotocol/java-sdk)をライブラリとしてビルドする
  - 以下手順を踏むとMavenのローカルリポジトリへのインストールまで実施してくれる
- 別途MCPサーバー用のプロジェクトを作成し、そこから依存関係を定義して使用する
  - java-sdk自体に手を入れて、MCPサーバーを作成するわけではない

## 環境の前提

- Windows環境+Java17JDK
- Mavenは無くてもビルド時に自動的に取得。Maven Wrapperというツールで実現している

## 最初のビルド

1. コードをclone
2. Java17 JDKにJavaのパスと、Java_Homeを設定
   - このプロジェクトのみで有効にするため`.vscode/settigs.json'にパスを記載

    ```json
    {
        "terminal.integrated.env.windows": {
            "JAVA_HOME": "C:\\java\\jdk-17",
            "PATH": "${env:PATH};C:\\java\\jdk-17\\bin"
        },
        "java.jdt.ls.java.home": "C:\\java\\jdk-17"
    }
    ```

3. `.\mvnw.cmd clean install -DskipTests`を実行すると、ビルドが成功した。
   - 最初に実行した際、一時ファイルへのアクセスセラーとなった。
   - `Remove-Item -Path "$env:TEMP\tmp*.tmp.dir" -Recurse -Force -ErrorAction SilentlyContinue`を実行したら解消された。
   - ゴミファイルが残っていたかもしれない。

---
Tips:

Mavenビルドの成果物は、各モジュールの `target` ディレクトリに保存される。

`.mvnw.cmd clean install -DskipTests` を実行した場合、以下の場所にJARファイルが生成される:

**主要な成果物の保存場所:**

1. **mcp-core** モジュール
   - `mcp-core\target\mcp-core-<version>.jar`

2. **mcp-json** モジュール
   - `mcp-json\target\mcp-json-<version>.jar`

3. **mcp-json-jackson2** モジュール
   - `mcp-json-jackson2\target\mcp-json-jackson2-<version>.jar`

4. **mcp-spring-webflux** モジュール
   - `mcp-spring\mcp-spring-webflux\target\mcp-spring-webflux-<version>.jar`

5. **mcp-spring-webmvc** モジュール
   - `mcp-spring\mcp-spring-webmvc\target\mcp-spring-webmvc-<version>.jar`

6. **mcp-test** モジュール
   - `mcp-test\target\mcp-test-<version>.jar`

また、`install` フェーズを実行しているため、これらの成果物はローカルのMavenリポジトリにもインストールされる:

- **Windowsの場合**: `C:\Users\<ユーザー名>\.m2\repository\io\modelcontextprotocol\...`

各 `target` ディレクトリ内の `maven-archiver/pom.properties` ファイルで、ビルドされたバージョン番号を確認できる。

---

## MCPのベースとなるプロジェクトの作成

1. `drsum-java-mcp`フォルダを作成。ここに新しいmavenプロジェクト作成
2. ここでもMaven Wrapperを使うため、.mvnフォルダ、mvnw、mvnw.cmdをjava-sdkからコピー
3. java-sdk、ログ、テストの依存関係をpom.xmlに記載
4. `.\mvnw.cmd clean package`で、ビルド及びjar作成
   1. 依存するライブラリを全部含めるfat.jarも一緒に作成するようにした

## DrSumEA.jarの組み込み

1. local mavenリポジトリへのインストール

   ```powershell
   # groupIdにドットが含まれる場合は、各パラメータをダブルクォートで囲む必要がある
   .\mvnw.cmd install:install-file "-Dfile=C:\DrSum57\DevKit\java\api\DrSumEA.jar" "-DgroupId=jp.co.dw_sapporo" "-DartifactId=DrSumEA" "-Dversion=5.7.0" "-Dpackaging=jar"
   ```

   > **Note**: PowerShellでは、groupIdに`.`が含まれる場合、パラメータ全体をダブルクォートで囲む必要があります。

2. pom.xmlへの依存関係の追加

   ```xml
   <dependency>
       <groupId>jp.co.dw_sapporo</groupId>
       <artifactId>DrSumEA</artifactId>
       <version>5.7.0</version>
   </dependency>
   ```

   インストール先: `C:\Users\<ユーザー名>\.m2\repository\jp\co\dw_sapporo\DrSumEA\5.7.0\`
