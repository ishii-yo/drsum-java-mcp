# DrSum MCPã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…

## ã‚„ã‚ŠãŸã„äº‹

- Dr.Sumã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¦ã€LLMã§ãƒ‡ãƒ¼ã‚¿åˆ†æã‚’è¡Œã†

## å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- ğŸ“‹ è¨ˆç”»å®Œäº†
- ğŸ”§ å®Ÿè£…æº–å‚™å®Œäº†ï¼ˆDrSumEA.jar APIç¢ºèªæ¸ˆã¿ï¼‰
- â³ å®Ÿè£…é–‹å§‹å¾…ã¡

## ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã«è¦æ±‚ã•ã‚Œã‚‹æ©Ÿèƒ½

- ãƒ¡ã‚¿æƒ…å ±ã®å–å¾—
- ãƒ¡ã‚¿æƒ…å ±ã«ã¯ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒä»˜ä¸ã•ã‚Œã‚‹
- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3è¡Œã€‚å®šæ•°ã§ã‚³ãƒ¼ãƒ‰ä¸Šå¤‰æ›´å¯èƒ½
- åˆ†æã®ãŸã‚ã®ã‚¯ã‚¨ãƒªãƒ¼ã®å®Ÿè¡Œ
- æ¥ç¶šæƒ…å ±ã®ä¿æŒ
- ä»¥ä¸‹ã®æ¥ç¶šæƒ…å ±ã¯ç§˜åŒ¿ã•ã‚Œã‚‹
  - hoståï¼šæ–‡å­—åˆ—
  - ãƒãƒ¼ãƒˆç•ªå·ï¼šæ–‡å­—åˆ—
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼šæ–‡å­—åˆ—
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼šæ–‡å­—åˆ—ã€‚ç©ºæ–‡å­—ã‚‚å¯èƒ½
  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åï¼šæ–‡å­—åˆ—

## å®Ÿè£…ä¸Šã®æ³¨æ„

- æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚µãƒ³ãƒ—ãƒ«ç›®çš„ãªã®ã§ã€ã§ãã‚‹ã ã‘æœ€å°é™ã®å®Ÿè£…ã‚’å¿ƒæ›ã‘ã‚‹ã€‚
- ã‚³ãƒ¼ãƒ‰ã¯DrSumMcpServer.javaå†…ã§å®Œçµã™ã‚‹ã‚ˆã†ã‚·ãƒ³ãƒ—ãƒ«ã«ã™ã‚‹
- DrSumã¸ã®æ¥ç¶šã«ã¤ã„ã¦ã¯DrSumEA.jarã‚’ä½¿ç”¨ã™ã‚‹
- Unit testã‚’æ›¸ãã“ã¨
- SOLIDåŸå‰‡ã«å¾“ã„ã€å¤‰æ›´å®¹æ˜“æ€§ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã«è€ƒæ…®ã—ã¦å®Ÿè£…ã™ã‚‹

## å®Ÿè£…è¨ˆç”»åŠã³TODO

### ã€ç¾çŠ¶æŠŠæ¡ã€‘

#### âœ… å®Œäº†ã—ã¦ã„ã‚‹ã‚‚ã®
- MCPã‚µãƒ¼ãƒãƒ¼ã®åŸºæœ¬æ§‹é€ ï¼ˆDrSumMcpServer.javaï¼‰
- Mavenãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- MCP Java SDKï¼ˆv0.14.1ï¼‰ã®çµ±åˆ
- ã‚µãƒ³ãƒ—ãƒ«è¦ç´„ãƒ„ãƒ¼ãƒ«ï¼ˆsummarizeï¼‰ã®å®Ÿè£…
- åŸºæœ¬çš„ãªUnit testã®é››å½¢
- DrSumEA.jarã®ãƒ­ãƒ¼ã‚«ãƒ«Mavenãƒªãƒã‚¸ãƒˆãƒªã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ç¢ºèª

#### âŒ æœªå®Ÿè£…ã®ã‚‚ã®
- Dr.Sumæ¥ç¶šæ©Ÿèƒ½ã®å®Ÿè£…
- ãƒ¡ã‚¿æƒ…å ±å–å¾—ãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—æ©Ÿèƒ½
- ã‚¯ã‚¨ãƒªãƒ¼å®Ÿè¡Œãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
- æ¥ç¶šæƒ…å ±ã®ä¿æŒãƒ»ç®¡ç†æ©Ÿèƒ½
- æ¥ç¶šæƒ…å ±ã®ç§˜åŒ¿åŒ–
- SOLIDåŸå‰‡ã«åŸºã¥ã„ãŸã‚³ãƒ¼ãƒ‰ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- DrSumEA.jarã‚’ä½¿ç”¨ã—ãŸå®Ÿè£…
- å®Ÿéš›ã®æ©Ÿèƒ½ã«å¯¾å¿œã—ãŸUnit test

---

### ã€è¦ä»¶åˆ†æã€‘

#### æ©Ÿèƒ½è¦ä»¶
1. **Dr.Sumæ¥ç¶šç®¡ç†**
   - æ¥ç¶šæƒ…å ±ï¼šhostã€portã€usernameã€passwordã€database
   - æ¥ç¶šã®ç¢ºç«‹ã¨ç¶­æŒ
   - æ¥ç¶šæƒ…å ±ã®ç§˜åŒ¿åŒ–

2. **ãƒ¡ã‚¿æƒ…å ±å–å¾—ãƒ„ãƒ¼ãƒ«ï¼ˆget_metadataï¼‰**
   - ãƒ†ãƒ¼ãƒ–ãƒ«/ãƒ“ãƒ¥ãƒ¼ã®ãƒ¡ã‚¿æƒ…å ±å–å¾—
   - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä»˜ä¸ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3è¡Œã€å®šæ•°ã§å¤‰æ›´å¯èƒ½ï¼‰
   - å‡ºåŠ›å½¢å¼ï¼šãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€  + ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

3. **ã‚¯ã‚¨ãƒªãƒ¼å®Ÿè¡Œãƒ„ãƒ¼ãƒ«ï¼ˆexecute_queryï¼‰**
   - SQLã‚¯ã‚¨ãƒªã®å®Ÿè¡Œ
   - çµæœã‚»ãƒƒãƒˆã®å–å¾—ã¨æ•´å½¢
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### éæ©Ÿèƒ½è¦ä»¶
- ã‚³ãƒ¼ãƒ‰ã¯DrSumMcpServer.javaå†…ã§å®Œçµï¼ˆæœ€å°é™å®Ÿè£…ï¼‰
- SOLIDåŸå‰‡ã«å¾“ã†ï¼ˆå¤‰æ›´å®¹æ˜“æ€§ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ï¼‰
- Unit testã‚’å®Ÿè£…
- DrSumEA.jarã‚’ä½¿ç”¨

---

### ã€æŠ€è¡“è¨­è¨ˆã€‘

#### ã‚¯ãƒ©ã‚¹æ§‹é€ ï¼ˆSOLIDåŸå‰‡æº–æ‹ ï¼‰

```
DrSumMcpServer.java
â”œâ”€â”€ DrSumMcpServer (ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹)
â”œâ”€â”€ DrSumConnection (æ¥ç¶šç®¡ç† - Single Responsibility)
â”‚   â”œâ”€â”€ ConnectionConfig (æ¥ç¶šæƒ…å ±ä¿æŒ)
â”‚   â””â”€â”€ connect() / disconnect() / isConnected()
â”œâ”€â”€ DrSumMetadataService (ãƒ¡ã‚¿æƒ…å ±å–å¾— - Single Responsibility)
â”‚   â”œâ”€â”€ getTableMetadata()
â”‚   â””â”€â”€ getSampleData()
â””â”€â”€ DrSumQueryService (ã‚¯ã‚¨ãƒªãƒ¼å®Ÿè¡Œ - Single Responsibility)
    â””â”€â”€ executeQuery()
```

#### MCPãƒ„ãƒ¼ãƒ«å®šç¾©

1. **configure_connection**
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼šhost, port, username, password, database
   - æ©Ÿèƒ½ï¼šæ¥ç¶šæƒ…å ±ã‚’è¨­å®šãƒ»æ¥ç¶šç¢ºç«‹
   - æˆ»ã‚Šå€¤ï¼šæ¥ç¶šæˆåŠŸ/å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

2. **get_metadata**
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼štable_name, sample_rows (optional, default=3)
   - æ©Ÿèƒ½ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¡ã‚¿æƒ…å ±+ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—
   - æˆ»ã‚Šå€¤ï¼šãƒ¡ã‚¿æƒ…å ±ã¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰

3. **execute_query**
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼šsql_query
   - æ©Ÿèƒ½ï¼šSQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ
   - æˆ»ã‚Šå€¤ï¼šå®Ÿè¡Œçµæœï¼ˆJSONå½¢å¼ï¼‰

4. **disconnect**
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼šãªã—
   - æ©Ÿèƒ½ï¼šDr.Sumæ¥ç¶šã®åˆ‡æ–­
   - æˆ»ã‚Šå€¤ï¼šåˆ‡æ–­æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

### ã€å®Ÿè£…TODOã€‘

#### Phase 1: åŸºç›¤æ•´å‚™ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰
- [ ] 1.1 ç¾åœ¨ã®DrSumMcpServerã‚¯ãƒ©ã‚¹ã‚’SOLIDåŸå‰‡ã«åŸºã¥ããƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
  - [ ] æ—¢å­˜ã®summarizeãƒ„ãƒ¼ãƒ«ã‚’æ®‹ã—ãŸã¾ã¾ã€æ–°è¦ã‚¯ãƒ©ã‚¹æ§‹é€ ã‚’è¿½åŠ 
  - [ ] ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆ

#### Phase 2: Dr.Sumæ¥ç¶šæ©Ÿèƒ½å®Ÿè£…
- [ ] 2.1 ConnectionConfigã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
  - [ ] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šhost, port, username, password, database
  - [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
  - [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç§˜åŒ¿åŒ–ï¼ˆãƒ­ã‚°å‡ºåŠ›æ™‚ï¼‰
  
- [ ] 2.2 DrSumConnectionã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
  - [ ] DrSumEA.jarã‚’ä½¿ç”¨ã—ãŸæ¥ç¶šæ©Ÿèƒ½
  - [ ] connect()ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] disconnect()ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] isConnected()ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] æ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°ã¯ä¸è¦ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«ï¼‰
  
- [ ] 2.3 configure_connectionãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
  - [ ] ãƒ„ãƒ¼ãƒ«å®šç¾©è¿½åŠ 
  - [ ] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
  - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- [ ] 2.4 disconnectãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
  - [ ] ãƒ„ãƒ¼ãƒ«å®šç¾©è¿½åŠ 
  - [ ] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…

#### Phase 3: ãƒ¡ã‚¿æƒ…å ±å–å¾—æ©Ÿèƒ½å®Ÿè£…
- [ ] 3.1 DrSumMetadataServiceã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
  - [ ] getTableMetadata()ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] getSampleData()ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3è¡Œï¼‰
  - [ ] SAMPLE_ROWSå®šæ•°å®šç¾©
  
- [ ] 3.2 get_metadataãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
  - [ ] ãƒ„ãƒ¼ãƒ«å®šç¾©è¿½åŠ ï¼ˆtable_name, sample_rowsï¼‰
  - [ ] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
  - [ ] ãƒ¡ã‚¿æƒ…å ±ã¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ï¼ˆJSONï¼‰

#### Phase 4: ã‚¯ã‚¨ãƒªãƒ¼å®Ÿè¡Œæ©Ÿèƒ½å®Ÿè£…
- [ ] 4.1 DrSumQueryServiceã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
  - [ ] executeQuery()ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] çµæœã‚»ãƒƒãƒˆã®æ•´å½¢
  - [ ] SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–æ¤œè¨
  
- [ ] 4.2 execute_queryãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
  - [ ] ãƒ„ãƒ¼ãƒ«å®šç¾©è¿½åŠ ï¼ˆsql_queryï¼‰
  - [ ] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
  - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### Phase 5: ãƒ†ã‚¹ãƒˆå®Ÿè£…
- [ ] 5.1 DrSumConnectionã®Unit test
  - [ ] æ¥ç¶šæˆåŠŸ/å¤±æ•—ã®ãƒ†ã‚¹ãƒˆ
  - [ ] æ¥ç¶šçŠ¶æ…‹ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
  
- [ ] 5.2 DrSumMetadataServiceã®Unit test
  - [ ] ãƒ¡ã‚¿æƒ…å ±å–å¾—ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
  
- [ ] 5.3 DrSumQueryServiceã®Unit test
  - [ ] ã‚¯ã‚¨ãƒªå®Ÿè¡ŒæˆåŠŸã®ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ
  
- [ ] 5.4 çµ±åˆãƒ†ã‚¹ãƒˆ
  - [ ] MCPãƒ„ãƒ¼ãƒ«å…¨ä½“ã®å‹•ä½œç¢ºèª
  - [ ] å®Ÿéš›ã®Dr.Sumç’°å¢ƒã§ã®å‹•ä½œç¢ºèªï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰

#### Phase 6: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] 6.1 README.mdã®æ›´æ–°
  - [ ] æ–°æ©Ÿèƒ½ã®ä½¿ã„æ–¹è¿½åŠ 
  - [ ] æ¥ç¶šè¨­å®šã®ä¾‹
  - [ ] åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§æ›´æ–°
  
- [ ] 6.2 CONFIGURATION.mdã®ä½œæˆ
  - [ ] Dr.Sumæ¥ç¶šè¨­å®šã®è©³ç´°
  - [ ] ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

---

### ã€å®Ÿè£…ã®å„ªå…ˆé †ä½ã€‘

1. **æœ€å„ªå…ˆ**: Phase 2ï¼ˆDr.Sumæ¥ç¶šæ©Ÿèƒ½ï¼‰
   - æ¥ç¶šã§ããªã‘ã‚Œã°ä»–ã®æ©Ÿèƒ½ã‚‚å‹•ä½œã—ãªã„
   
2. **æ¬¡å„ªå…ˆ**: Phase 3ï¼ˆãƒ¡ã‚¿æƒ…å ±å–å¾—ï¼‰
   - ãƒ‡ãƒ¼ã‚¿åˆ†æã®åŸºç›¤ã¨ãªã‚‹æ©Ÿèƒ½
   
3. **é€šå¸¸**: Phase 4ï¼ˆã‚¯ã‚¨ãƒªãƒ¼å®Ÿè¡Œï¼‰
   - å®Ÿéš›ã®åˆ†ææ©Ÿèƒ½
   
4. **é‡è¦**: Phase 5ï¼ˆãƒ†ã‚¹ãƒˆï¼‰
   - å“è³ªä¿è¨¼ã®ãŸã‚ä¸¦è¡Œå®Ÿæ–½

5. **æœ€å¾Œ**: Phase 6ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
   - å®Œæˆå¾Œã«ã¾ã¨ã‚ã¦æ›´æ–°

---

### ã€æŠ€è¡“çš„ãªè€ƒæ…®äº‹é …ã€‘

#### DrSumEA.jarã®ä½¿ç”¨æ–¹æ³•ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šï¼‰

##### åŸºæœ¬çš„ãªæ¥ç¶šãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆDBI - Database Interfaceï¼‰
```java
// 1. æ¥ç¶šã®ç¢ºç«‹
DWDbiConnection connection = new DWDbiConnection(host, port, username, password);

// 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é–‹ã
connection.openDatabase(databaseName);

// 3. ã‚«ãƒ¼ã‚½ãƒ«ã‚’å–å¾—ã—ã¦ã‚¯ã‚¨ãƒªãƒ¼å®Ÿè¡Œ
DWDbiCursor cursor = connection.cursor();
cursor.execute("SELECT * FROM ãƒ†ãƒ¼ãƒ–ãƒ«å");

// 4. çµæœå–å¾—
Vector<Vector<String>> records = cursor.fetchmany(10);  // 10ä»¶å–å¾—

// 5. ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±å–å¾—
DWColumnInfo[] schema = cursor.m_oDescription;  // executeå¾Œã«åˆ©ç”¨å¯èƒ½

// 6. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
cursor.close();
connection.close();
```

##### ãƒ¡ã‚¿æƒ…å ±å–å¾—ã®API
```java
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸€è¦§
DWDatabaseInfo[] dbList = connection.getDatabaseList();

// ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
DWTableInfo[] tableList = connection.getTableList(databaseName);

// ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ï¼ˆã‚«ãƒ©ãƒ æƒ…å ±ï¼‰
DWColumnInfo[] schema = connection.getSchema(databaseName, tableName);
// schema[i].m_sName      : ã‚«ãƒ©ãƒ å
// schema[i].m_iType      : ãƒ‡ãƒ¼ã‚¿å‹
// schema[i].m_sDisplay   : è¡¨ç¤ºå
// schema[i].m_iPrecision : ç²¾åº¦

// ãƒ“ãƒ¥ãƒ¼æƒ…å ±
DWViewInfo viewInfo = connection.getViewInfo(databaseName, tableName);
```

##### é‡è¦ãªã‚¯ãƒ©ã‚¹
- **DWDbiConnection**: DBIæ¥ç¶šã‚¯ãƒ©ã‚¹ï¼ˆextends DWConnectionï¼‰
- **DWDbiCursor**: SQLã‚«ãƒ¼ã‚½ãƒ«ã‚¯ãƒ©ã‚¹
- **DWColumnInfo**: ã‚«ãƒ©ãƒ ãƒ¡ã‚¿æƒ…å ±
- **DWDatabaseInfo**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±
- **DWTableInfo**: ãƒ†ãƒ¼ãƒ–ãƒ«æƒ…å ±
- **DWViewInfo**: ãƒ“ãƒ¥ãƒ¼æƒ…å ±
- **DWException**: Dr.Sumä¾‹å¤–ã‚¯ãƒ©ã‚¹

##### ä¾‹å¤–å‡¦ç†
```java
try {
    // Dr.Sumæ“ä½œ
} catch (DWException e) {
    // Dr.Sumå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
} catch (Exception e) {
    // ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
} finally {
    // ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
}
```

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡Œæ•°
```java
private static final int DEFAULT_SAMPLE_ROWS = 3;
```

#### æ¥ç¶šæƒ…å ±ã®ç§˜åŒ¿åŒ–
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ãƒ­ã‚°ã«å‡ºåŠ›ã—ãªã„
- toString()ãƒ¡ã‚½ãƒƒãƒ‰ã§"****"ã«ç½®æ›

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- Dr.Sumæ¥ç¶šã‚¨ãƒ©ãƒ¼
- SQLã‚¨ãƒ©ãƒ¼
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

#### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- Mockitoã‚’ä½¿ç”¨ã—ã¦Dr.Sumæ¥ç¶šã‚’ãƒ¢ãƒƒã‚¯åŒ–
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ç¶²ç¾…

---

### ã€å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‘

#### ConnectionConfigã‚¯ãƒ©ã‚¹ï¼ˆå†…éƒ¨ã‚¯ãƒ©ã‚¹ï¼‰
```java
/**
 * Dr.Sumæ¥ç¶šè¨­å®šã‚’ä¿æŒã™ã‚‹ã‚¯ãƒ©ã‚¹
 */
static class ConnectionConfig {
    private final String host;
    private final int port;
    private final String username;
    private final String password;  // ç§˜åŒ¿åŒ–å¯¾è±¡
    private final String database;
    
    public ConnectionConfig(String host, int port, String username, 
                          String password, String database) {
        this.host = host;
        this.port = port;
        this.username = username;
        this.password = password;
        this.database = database;
    }
    
    @Override
    public String toString() {
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯è¡¨ç¤ºã—ãªã„
        return String.format("ConnectionConfig{host=%s, port=%d, username=%s, password=****, database=%s}",
                           host, port, username, database);
    }
}
```

#### DrSumConnectionã‚¯ãƒ©ã‚¹ï¼ˆå†…éƒ¨ã‚¯ãƒ©ã‚¹ï¼‰
```java
/**
 * Dr.Sumæ¥ç¶šã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹
 */
static class DrSumConnection {
    private DWDbiConnection connection;
    private ConnectionConfig config;
    
    public void connect(ConnectionConfig config) throws DWException {
        this.config = config;
        this.connection = new DWDbiConnection(
            config.host, config.port, config.username, config.password);
        this.connection.openDatabase(config.database);
    }
    
    public boolean isConnected() {
        return connection != null && connection.m_hDatabase != 0;
    }
    
    public void disconnect() throws DWException {
        if (connection != null) {
            connection.close();
            connection = null;
        }
    }
    
    public DWDbiConnection getConnection() {
        return connection;
    }
}
```

#### DrSumMetadataServiceã‚¯ãƒ©ã‚¹ï¼ˆå†…éƒ¨ã‚¯ãƒ©ã‚¹ï¼‰
```java
/**
 * Dr.Sumãƒ¡ã‚¿æƒ…å ±å–å¾—ã‚µãƒ¼ãƒ“ã‚¹
 */
static class DrSumMetadataService {
    private static final int DEFAULT_SAMPLE_ROWS = 3;
    private final DrSumConnection dsConnection;
    
    public DrSumMetadataService(DrSumConnection connection) {
        this.dsConnection = connection;
    }
    
    public String getTableMetadata(String tableName, int sampleRows) throws DWException {
        DWDbiConnection conn = dsConnection.getConnection();
        String dbName = conn.m_sDatabase;
        
        // ãƒ¡ã‚¿æƒ…å ±å–å¾—
        DWColumnInfo[] schema = conn.getSchema(dbName, tableName);
        
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—
        DWDbiCursor cursor = conn.cursor();
        try {
            String sql = String.format("SELECT * FROM %s LIMIT %d", tableName, sampleRows);
            cursor.execute(sql);
            Vector<Vector<String>> samples = cursor.fetchmany(sampleRows);
            
            // JSONå½¢å¼ã§æ•´å½¢ã—ã¦è¿”å´
            return formatMetadataAsJson(schema, samples);
        } finally {
            cursor.close();
        }
    }
    
    private String formatMetadataAsJson(DWColumnInfo[] schema, Vector<Vector<String>> samples) {
        // JSONæ•´å½¢ãƒ­ã‚¸ãƒƒã‚¯
        // ...
    }
}
```

#### MCPãƒ„ãƒ¼ãƒ«å®Ÿè£…ä¾‹
```java
// configure_connectionãƒ„ãƒ¼ãƒ«
private static McpSchema.Tool createConfigureConnectionTool() {
    return McpSchema.Tool.builder()
        .name("configure_connection")
        .description("Configure and establish connection to Dr.Sum server")
        .inputSchema(McpSchema.ToolInputSchema.builder()
            .properties(Map.of(
                "host", Map.of("type", "string", "description", "Dr.Sum server host"),
                "port", Map.of("type", "integer", "description", "Dr.Sum server port"),
                "username", Map.of("type", "string", "description", "Username"),
                "password", Map.of("type", "string", "description", "Password (can be empty)"),
                "database", Map.of("type", "string", "description", "Database name")
            ))
            .required(List.of("host", "port", "username", "database"))
            .build())
        .build();
}

// get_metadataãƒ„ãƒ¼ãƒ«
private static McpSchema.Tool createGetMetadataTool() {
    return McpSchema.Tool.builder()
        .name("get_metadata")
        .description("Get table metadata with sample data from Dr.Sum")
        .inputSchema(McpSchema.ToolInputSchema.builder()
            .properties(Map.of(
                "table_name", Map.of("type", "string", "description", "Table name"),
                "sample_rows", Map.of("type", "integer", "description", "Number of sample rows (default: 3)")
            ))
            .required(List.of("table_name"))
            .build())
        .build();
}
```

---

### ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã€‘

1. âœ… DrSumEA.jarã®APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª **â† å®Œäº†ï¼**
2. Phase 1ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‹ã‚‰é–‹å§‹
   - ç¾åœ¨ã®DrSumMcpServerã‚¯ãƒ©ã‚¹ã«å†…éƒ¨ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
   - SOLIDåŸå‰‡ã«å¾“ã£ãŸè¨­è¨ˆ
3. Phase 2ã®Dr.Sumæ¥ç¶šæ©Ÿèƒ½å®Ÿè£…
   - ConnectionConfigå®Ÿè£…
   - DrSumConnectionå®Ÿè£…
   - configure_connectionãƒ„ãƒ¼ãƒ«å®Ÿè£…
4. å°ã•ã„å˜ä½ã§å®Ÿè£…â†’ãƒ†ã‚¹ãƒˆâ†’ã‚³ãƒŸãƒƒãƒˆã‚’ç¹°ã‚Šè¿”ã™

**æ¨å¥¨å®Ÿè£…é †åº:**
1. ConnectionConfig â†’ DrSumConnectionï¼ˆPhase 2.1, 2.2ï¼‰
2. configure_connectionãƒ„ãƒ¼ãƒ« + ãƒ†ã‚¹ãƒˆï¼ˆPhase 2.3 + Phase 5.1ï¼‰
3. DrSumMetadataServiceï¼ˆPhase 3.1ï¼‰
4. get_metadataãƒ„ãƒ¼ãƒ« + ãƒ†ã‚¹ãƒˆï¼ˆPhase 3.2 + Phase 5.2ï¼‰
5. DrSumQueryServiceï¼ˆPhase 4.1ï¼‰
6. execute_queryãƒ„ãƒ¼ãƒ« + ãƒ†ã‚¹ãƒˆï¼ˆPhase 4.2 + Phase 5.3ï¼‰
7. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆPhase 6ï¼‰
  